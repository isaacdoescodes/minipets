<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Pet</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="shortcut icon" href="/assets/img/favicon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <script src="/assets/js/html2canvas.min.js"></script>
    <script>
        function newbeez() {
            if(window.location.pathname == "/") return;
            if(window.location.pathname == "/newpet") return;
            if(window.location.pathname == "/share") return;
            if(localStorage.petname) return;
            window.location = "/";
        }
        newbeez();
    </script>
    <!-- Matomo -->
<script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://minipet.matomo.cloud/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='//cdn.matomo.cloud/minipet.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->
  
</head>
<body>
    <div class="content"><br>
        <h1><img src="/assets/img/favicon.png" height="50px" style="transform: translateY(15px);">Your Pet</h1>
        <hr>
         <div id="toshare">


    <div style="font-size: 30px;" id="petname">...</div>
    <!--Age: <b><span id="petage">...</span></b> <br>-->
    Bond Points: <b><span id="bondpoints">40</span><br></b>Hunger: <b><span id="hunger">7</span></b><br><br>
    <!--<small>(1 year =
    3 real days)</small><br>-->

    <img src="about:blank" alt="" id="petimg" width="80%"><br><br>
</div>
<div style="position: absolute; left: 50%; transform: translateX(-50%); bottom: 85px; width: 100%;"
    onclick="loadcanvas();">
    <button class="btn" onclick="feed();" id="feeds">Feed (0)</button>
    <button class="btn" onclick="window.location= '/play' "> Play </button>
    <button class="btn" onclick="share();">Share</button><br><br>
    <a href="/guide" class="btn">Pet Guide</a><br><br>
    <a href="/delete" class="btn">Release into the wild</a>
</div>


<script>

    var chomp = new Audio('/chomp.mp3');
    localStorage.havepet = true;
    document.getElementById("petname").innerText = localStorage.petname;
    // document.getElementById("petage").innerHTML = localStorage.petage;
    document.getElementById("feeds").innerHTML = "Feed (" + localStorage.feeds + ")";
    if (localStorage.feeds == 0) {
        document.getElementById("feeds").innerHTML = "Buy Feeds";
    }
    document.getElementById("hunger").innerHTML = localStorage.hunger;
    document.getElementById("bondpoints").innerHTML = localStorage.bondpoints;
    const start = Date.now();
    if (start - localStorage.originalunixage > 259200) {
        localStorage.petage = 1;
        // document.getElementById("petage").innerHTML = localStorage.petage;
        localStorage.originalunixage = Date.now();
    }
    function loadcanvas() {
        html2canvas(document.querySelector("#toshare")).then(canvas => {
            canvas.id = "canvas";
            canvas.style.display = "none";
            document.body.appendChild(canvas);
        });
    }

    function feed() {
        if (localStorage.hunger == 0) {
            alert("Your pet is full up and doesn't require food.")
            return;

        }
        if (localStorage.feeds == 0) {

            if (bondpoints < 8) {
                alert("Can't afford feeds. 8 bond points required.")
                return;
            }
            if (confirm("This will cost 8 bond points and give you 5 feeds. Would you like to continue?")) {
                localStorage.bondpoints = parseInt(localStorage.bondpoints) - 8;
                localStorage.feeds = parseInt(localStorage.feeds) + 5;
                document.getElementById("feeds").innerHTML = "Feed (" + localStorage.feeds + ")";
                document.getElementById("bondpoints").innerHTML = localStorage.bondpoints;
                return;
            }
            else {
                return;
            }



        }
        chomp.play();
        localStorage.feeds = localStorage.feeds - 1;
        localStorage.hunger = localStorage.hunger - 1;
        document.getElementById("feeds").innerHTML = "Feed (" + localStorage.feeds + ")";
        document.getElementById("hunger").innerHTML = localStorage.hunger;
        if (localStorage.hunger == 0) {
            localStorage.bondpoints = parseInt(localStorage.bondpoints) + 5;
            document.getElementById("bondpoints").innerHTML = localStorage.bondpoints;
        }
        if (localStorage.feeds == 0) {
            document.getElementById("feeds").innerHTML = "Buy feeds";
        }
    }
    document.getElementById("petimg").src = "/assets/img/pets/" + localStorage.petlook + "/" + "0" + ".png";
    console.log(start);

    const shareData = {
        title: 'I got a new pet!',
        text: 'I got a new pet on \'MiniPet\' by isaboo.co.uk. Click on the link to see what I got and make your own!',
        url: 'https://minipet.isaboo.co.uk/share?n=' + localStorage.petname + '&l=' + localStorage.petlook + '/0&g=' + localStorage.petgender + '&b=' + localStorage.bondpoints
    }

    // Share must be triggered by "user activation"

    function share() {

        var canvas = document.getElementById('canvas');
        var dataURL = canvas.toDataURL();
        console.log(dataURL);
        var filesArray = [dataURL]


        navigator.share(shareData);

    }
    loadcanvas();
</script>
         <footer>
        &copy; isaboo.co.uk 2022. All rights reserved.<br><br>
    </footer>
    </div>
    
</body>
</html>